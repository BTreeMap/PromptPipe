# PromptPipe Codebase Cleanup Report

## Purpose

This report identifies redundant components, legacy code paths, and unused modules in the PromptPipe codebase. Review each section before deciding whether to keep or remove the listed items.

---

## 1. Flow Modules & Tools

### Redundant or Legacy Tool Definitions

- **CoordinatorModule, IntakeModule, FeedbackModule**
  - All three modules contain nearly identical logic for tool definition and tool call loops.
  - Consider refactoring to a shared base or utility to avoid duplication.

### Unused/Legacy Tool Calls

- **StateTransitionTool, ProfileSaveTool, PromptGeneratorTool, SchedulerTool**
  - Some tool definitions and calls are repeated across modules, but not all are actively used in every flow.
  - Check for unused tool calls in each module and remove if not required for the flow.

---

## 2. State Management

### Redundant StateManager Methods

- **StoreBasedStateManager (state_manager.go)**
  - Methods like `ResetState` and `TransitionState` are defined but may not be used in all flows.
  - Review usage and remove if not required.

### Legacy State Keys

- **state.go**
  - Some state keys and interfaces may be unused or duplicated across modules.
  - Consider consolidating or removing unused keys.

---

## 3. Messaging & WhatsApp Integration

### Redundant Response Handlers

- **response_handler.go**
  - Multiple handler types (branch, static, GenAI, conversation) may overlap in functionality.
  - Review for legacy handlers that are no longer registered or used.

### WhatsAppService

- **whatsapp_service.go, whatsapp.go**
  - Some error handling and event processing logic may be legacy or duplicated.
  - Remove unused constants, error variables, or mock/test code not referenced in production.

---

## 4. GenAI & Lockfile

### GenAI Client

- **genai.go, debug_test.go**
  - Debug logging and test logic may be legacy if not used in current flows.
  - Remove old debug/test code if not referenced.

### Lockfile

- **lockfile.go, lockfile_test.go**
  - Test logic and error handling for lock acquisition may be redundant if not used in production.
  - Remove legacy test code.

---

## 5. Store Backends

### Redundant Store Methods

- **store.go, postgres.go, sqlite.go**
  - Methods for receipts, responses, hooks, and participants may be duplicated or unused.
  - Remove legacy cleanup/test methods if not required.

---

## 6. Test Scripts & Utilities

### Bash Scripts

- **test-scripts/quick-delete-conversation-participants.sh, test-conversation-clean.sh, test-conversation.sh**
  - Cleanup logic and participant deletion may be duplicated across scripts.
  - Consolidate or remove redundant cleanup code.

### Utility Tests

- **random_test.go**
  - Test helpers for random string generation may be legacy if not used in production.
  - Remove unused test helpers.

---

## 7. Recovery Infrastructure

### Recovery Registry

- **recovery.go**
  - Some recovery interfaces and registry logic may be legacy if not used in current flows.
  - Remove unused recovery code.

---

## 8. SQL Migrations

### Legacy Tables/Indexes

- **migrations_postgres.sql, migrations_sqlite.sql, migrations.sql**
  - Some tables and indexes may be legacy or unused (e.g., intervention_participants, intervention_responses).
  - Remove unused tables and indexes.

---

## Recommendations

- Review each section and cross-reference with current usage in the codebase.
- Mark items for removal only if confirmed unused or redundant.
- Consider refactoring duplicated logic into shared utilities or base classes.

---

## Next Steps

- Indicate which items to keep or remove.
- After your decision, code modifications can be performed as instructed.

---

*Generated by GitHub Copilot on August 12, 2025.*
